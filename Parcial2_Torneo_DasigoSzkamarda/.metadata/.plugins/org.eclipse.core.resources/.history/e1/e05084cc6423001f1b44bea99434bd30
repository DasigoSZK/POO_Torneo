package torneo;

import javax.swing.JOptionPane;

public class PeleadorConTransformacion extends PeleadorConTecnica{
	
	
	private Transformacion transformacion;
	private boolean transformado;
	
	//----------------------------Constructor----------------------------
	//Constructor completo
	public PeleadorConTransformacion(String nombre, double puntosVida, double puntosVidaMax, double danoXsegundo,
			boolean tieneTecnicaEspecial, boolean puedeTransformarse, TecnicaEspecial tecnica, Transformacion transformacion) {
		super(nombre, puntosVida,puntosVidaMax , danoXsegundo, tieneTecnicaEspecial, puedeTransformarse, tecnica);
		this.transformacion = transformacion;
		this.transformado = false;
	}
	//Constructor sin transformacion
	public PeleadorConTransformacion(String nombre, double puntosVida, double puntosVidaMax, double danoXsegundo,
			boolean tieneTecnicaEspecial, boolean puedeTransformarse, TecnicaEspecial tecnica) {
		super(nombre, puntosVida, puntosVidaMax, danoXsegundo, tieneTecnicaEspecial, puedeTransformarse, tecnica);
		this.transformacion = new Transformacion("Poder M√°ximo", 1.2, 1.5);
		this.transformado = false;
	}
	//Constructor sin transformacion/tecnica
	public PeleadorConTransformacion(String nombre, double puntosVida, double puntosVidaMax, double danoXsegundo,
			boolean tieneTecnicaEspecial, boolean puedeTransformarse) {
		super(nombre, puntosVida, puntosVidaMax, danoXsegundo, tieneTecnicaEspecial, puedeTransformarse, new TecnicaEspecial("Bola de Energ√≠a", 100));
		this.transformacion = new Transformacion("Poder M√°ximo", 1.2, 1.5);
		this.transformado = false;
	}
	
	
	//----------------------------M√©todos----------------------------
	
	//Se transforma multiplicando VIDA y DA√ëO
	public void transformarse() {
		
		//Recupera toda su vitalidad
		this.setPuntosVida(this.getPuntosVidaMax());
		
		//Multiplica la vida del peleador
		this.setPuntosVida(this.getPuntosVida() * this.getTransformacion().getVidaExtra());
		//Multiplica el da√±o por segundo del peleador
		this.setDanoXsegundo(this.getDanoXsegundo() * this.getTransformacion().getDanoExtra());
		
		this.transformado = true;
	}
	
	//Vuelve a su estado base desde la transformaci√≥n
	public void volverEstadoBase() {
		
		//Reduce su vida m√°xima
		this.setPuntosVida(this.getPuntosVida() / this.getTransformacion().getVidaExtra());
		
		//Reduce su da√±o por segundo
		this.setDanoXsegundo(this.getDanoXsegundo() / this.getTransformacion().getDanoExtra());
		
		this.transformado = false;
	}
	
	//SOBRESCRIBE el m√©todo pelear pero con T√âCNICA y TRANSFORMACION
	public Peleador[] pelear(Peleador contrincante) {
		
		boolean tecnica1 = false;
		boolean tecnica2 = false;
		boolean transformacionContrincante = false;
		boolean golpeCritico;
		
		//Array para guardar al ganador(pos 0) y al perdedor(pos 1)
		Peleador[] ganador_perdedor = new Peleador[2];
		String historialPelea = this.getNombre() + " VS " + contrincante.getNombre() + "\n";
		
		//Pelean hasta que uno se quede sin vida
		while(this.getPuntosVida() > 0 && contrincante.getPuntosVida() > 0) {
			
			//Peleador 1 golpea al Peleador 2
			if(this.getPuntosVida() > 0) {
				
				//Posibilidad de 20% de golpe cr√≠tico
				golpeCritico = (int)(Math.random() * 10) < 2;
				
				//Si es golpe CR√çTICO
				if(golpeCritico) {
					
					//Golpea un 50% mas fuerte
					contrincante.setPuntosVida(contrincante.getPuntosVida() - (this.getDanoXsegundo() * 1.50));
					if(contrincante.getPuntosVida() < 0) contrincante.setPuntosVida(0);
					historialPelea += this.getNombre() + " lanza un <html><b>golpe CR√çTICO</b><html>"+ " (-" + (this.getDanoXsegundo() * 1.50) + " HP) "+ " a " 
							+ contrincante.getNombre() + " (" + contrincante.getPuntosVida() + "HP)\n";
					
				//Si es golpe NORMAL
				}else{		
					
					contrincante.setPuntosVida(contrincante.getPuntosVida() - this.getDanoXsegundo());
					if(contrincante.getPuntosVida() < 0) contrincante.setPuntosVida(0);
					historialPelea += this.getNombre() + " golpea"+ " (-" + this.getDanoXsegundo() + " HP) "+ " a " 
							+ contrincante.getNombre() + " (" + contrincante.getPuntosVida() + "HP)\n";
					
				}
				
			}
			
			//Peleador 2 golpea al Peleador 1
			if(contrincante.getPuntosVida() > 0) {	
				
				//Posibilidad de 20% de golpe cr√≠tico
				golpeCritico = (int)(Math.random() * 10) < 2;
				
				//Si es golpe CR√çTICO
				if(golpeCritico) {
					
					//Golpea un 50% mas fuerte
					this.setPuntosVida(this.getPuntosVida() - (contrincante.getDanoXsegundo()*1.50));
					if(this.getPuntosVida() < 0) this.setPuntosVida(0);
					historialPelea += contrincante.getNombre() + " lanza un <html><b>golpe CR√çTICO</b><html>"+ " (-" + (contrincante.getDanoXsegundo()*1.50) + " HP) "+ " a " 
							+ this.getNombre() + " (" + this.getPuntosVida() + "HP)\n";
					
				//Si es golpe NORMAL
				}else {
					this.setPuntosVida(this.getPuntosVida() - contrincante.getDanoXsegundo());
					if(this.getPuntosVida() < 0) this.setPuntosVida(0);
					historialPelea += contrincante.getNombre() + " golpea"+ " (-" + contrincante.getDanoXsegundo() + " HP) "+ " a " 
							+ this.getNombre() + " (" + this.getPuntosVida() + "HP)\n";
				}
				
			}
			
			//Si tienen menos de 800HP, se TRANSFORMAN
			if(this.getPuntosVida() <= 800 && this.getPuntosVida() > 0 && !this.isTransformado()) {
				this.transformarse();
				historialPelea += "‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è" + this.getNombre() + " se transforma en " + this.getTransformacion().getNombre()+ "‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è\n";
			}
			if(contrincante.getPuntosVida() <= 800 && contrincante.getPuntosVida() > 0  
					&& contrincante.isPuedeTransformarse() && !transformacionContrincante) {
				contrincante.transformarse();
				transformacionContrincante = true;
				historialPelea += "‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è" + contrincante.getNombre() + " se transforma en " 
				+ contrincante.getTransformacion().getNombre() + "‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è\n";
			}
			
			//Si tienen menos del 500HP, ejecutan sus T√âCNICAS ESPECIALES
			if(this.getPuntosVida() <= 500 && this.getPuntosVida() > 0 && !tecnica1) {
				this.usarTecnica(contrincante);
				if(contrincante.getPuntosVida() < 0) contrincante.setPuntosVida(0);
				tecnica1 = true;
				historialPelea += "üí£üí£üí£üí£" + this.getNombre() + " utiliza \"" + this.getTecnica().getNombre() + "\" sobre " + contrincante.getNombre() 
				+ " (-" + this.getTecnica().getDano() + "HP)" + "üí£üí£üí£üí£\n";
			}
			if(contrincante.getPuntosVida() <= 500 && contrincante.getPuntosVida() > 0 
					&& contrincante.isTieneTecnicaEspecial() && !tecnica2) {
				contrincante.usarTecnica(this);
				if(this.getPuntosVida() < 0) this.setPuntosVida(0);
				tecnica2 = true;
				historialPelea += "üí£üí£üí£üí£" + contrincante.getNombre() + " utiliza \"" + contrincante.getTecnica().getNombre() + "\" sobre " + this.getNombre() 
				+ " (-" + contrincante.getTecnica().getDano() + "HP)" + "üí£üí£üí£üí£\n";
			}
		}
		
		//Vuelven a su estado base
		if(this.transformado) {
			this.volverEstadoBase();
		}
		if(contrincante.isPuedeTransformarse() && transformacionContrincante) {
			contrincante.volverEstadoBase();
		}
		
		if(this.getPuntosVida() <= 0) {
			//Gana el contrincante
			ganador_perdedor[0] = contrincante;
			ganador_perdedor[1] = this;
			historialPelea += "‚ò†Ô∏è‚ò†Ô∏è‚ò†Ô∏è" + this.getNombre() + " ya no es capaz de seguir peleando‚ò†Ô∏è‚ò†Ô∏è‚ò†Ô∏è "
					+ "\n\n üéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏è  " + contrincante.getNombre() + " es el GANADOR  üéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏è";
		}else {
			//Gana el peleador actual
			ganador_perdedor[0] = this;
			ganador_perdedor[1] = contrincante;	
			historialPelea += "‚ò†Ô∏è‚ò†Ô∏è‚ò†Ô∏è" + contrincante.getNombre() + " ya no es capaz de seguir peleando‚ò†Ô∏è‚ò†Ô∏è‚ò†Ô∏è "
					+ "\n\n üéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏è  " + this.getNombre() + " es el GANADOR  üéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏èüéñÔ∏è";
		}
		
		JOptionPane.showMessageDialog(null, historialPelea);
		return ganador_perdedor;
		
	}
	
	
	public Transformacion getTransformacion() {
		return transformacion;
	}
	public void setTransformacion(Transformacion transformacion) {
		this.transformacion = transformacion;
	}
	public boolean isTransformado() {
		return transformado;
	}
	public void setTransformado(boolean transformado) {
		this.transformado = transformado;
	}
	
	
	
	
}
